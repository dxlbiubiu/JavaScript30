<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>LocalStorage</title>

		<style type="text/css">
			html {
				box-sizing: border-box;
				background: url('http://wes.io/hx9M/oh-la-la.jpg') center no-repeat;
				background-size: cover;
				min-height: 100vh;
				display: flex;
				justify-content: center;
				align-items: center;
				text-align: center;
				font-family: futura, "trebuchet ms", arial, sans-serif;
			}

			*,
			*:before,
			*:after {
				box-sizing: inherit;
			}

			embed {
	      fill:white;
	      background: rgba(0,0,0,0.1);
	      padding: 20px;
	      border-radius: 50%;
	      width:200px;
	      margin-bottom: 50px;
	    }

			.wrapper {
				padding: 20px;
				max-width: 350px;
				background: rgba(255,255,255,0.95);
				box-shadow: 0 0 0 10px rgba(0,0,0,0.1);
			}

			h2 {
				text-align: center;
				margin: 0;
				font-weight: 200;
			}

			.plates {
				margin: 0;
				padding: 0;
				text-align: left;
				list-style: none;
			}

			.plates li {
				border-bottom: 1px solid rgba(0,0,0,0.2);
				padding: 10px 0;
				font-weight: 100;
				display: flex;
			}

			.plates label {
				flex: 1;
				cursor: pointer;
			}

			.plates input {
				display: none;
			}

			.plates input + label:before {
				content: 'â¬œï¸';
				margin-right: 10px;
			}

			.plates input:checked + label:before {
				content: 'ğŸŒ®';
			}

			.add-items {
				margin-top: 20px;
			}

			.add-items input {
				padding: 10px;
				outline: 0;
				border: 1px solid rgba(0,0,0,0.1);
			}
		</style>
	</head>
	<body>
		<embed src="method-draw-image.svg" type="image/svg+xml" ></embed>

		<div class="wrapper">
			<h2>LOCAL TAPAS</h2>
			<p></p>
			<ul class="plates">
				<li>Loading Tapas...</li>
			</ul>
			<form class="add-items">
				<input type="text" name="item" placeholder="Item Name" required=""/>
				<input type="submit" value="+ Add Item"/>
			</form>
		</div>
	</body>
	<script type="text/javascript">
		// æå‰å®šä¹‰å¥½æ‰€æœ‰ç”¨åˆ°çš„å˜é‡ï¼›
		// æ·»åŠ itemçš„æŒ‰é’®
		const addItems = document.querySelector('.add-items');
		// todoliståˆ—è¡¨
		const itemsList = document.querySelector('.plates');
		// æœ¬åœ°ç¼“å­˜çš„æ‰€æœ‰todoitem
		const items = JSON.parse(localStorage.getItem('items')) || [];

		// æ·»åŠ itemäº‹ä»¶
		function addItem (e) {
			//é˜»æ­¢é»˜è®¤äº‹ä»¶çš„è§¦å‘ï¼Œé˜²æ­¢åœ¨æäº¤åé¡µé¢è‡ªå·±åˆ·æ–°
			e.preventDefault();
			const text = this.querySelector('[name=item]').value;
			const item = {
				//ES6çš„ç®€å†™å½¢å¼ => text: text;
				text,
				done: false
			};
			items.push(item);
			localStorage.setItem('items', JSON.stringify(items));
			populateList(items, itemsList);
			//æ·»åŠ å®Œæ•°æ®åï¼Œé‡ç½®è¾“å…¥æ¡†
			this.reset();
		}
		addItems.addEventListener('submit', addItem);

		// åˆ‡æ¢å®ŒæˆçŠ¶æ€äº‹ä»¶
		function toggleDone (e) {
			// è·³è¿‡æ‰€æœ‰inputï¼Œåªå¤„ç†label
			if (!e.target.matches('input')) {
				return;
			}
			const node = e.target;
			const index = node.dataset.index;
			items[index].done = !items[index].done;
			localStorage.setItem('items', JSON.stringify(items));
			populateList(items, itemsList);
		}
		itemsList.addEventListener('click', toggleDone);

		// åˆ—è¡¨æ˜¾ç¤ºå‡½æ•°
		// è®¾ç½®é»˜è®¤å€¼ï¼Œé˜²æ­¢å‚æ•°å‡ºé”™çš„æ—¶å€™crash
		function populateList (populates = [], place) {
			place.innerHTML = populates.map((populate, index) => {
				return `
					<li>
						<input type="checkbox" id=item${index} data-index=${index} ${populate.done ? 'checked' : ''}>
						<label for="item${index}">${(populate.text)}</label>
					</li>
				`;
			}).join('');
		}

		populateList(items, itemsList);

		// æ¸…é™¤ç¼“å­˜
		// åœ¨å…³é—­æµè§ˆå™¨ä¹‹åæ¸…é™¤ç¼“å­˜
//		window.onbeforeunload = function (e) {
//			localStorage.removeItem('items');
//			 let confirmationMessage = "\o/";
//			e.returnValue = confirmationMessage;
//			return confirmationMessage;
//		}
	</script>
</html>
